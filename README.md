# Zen Journal 1.0.0
A journalling web application that encourages users to foster this healthy habit in the pursuit of mindfulness.

This version allows users to make entries based on a prompt that's generated by
OpenAI. You will be able to see the number of consecutive days which you've been
journalling (streak) as well as some other useful stats such as number of words
written, number of entries made, etc.

A note on development, the app has been tested (integration) through Jest, Testing
Library and React Testing Library. However it has not undergone e2e testing with Cypress.

## Zen Journal 2.0.0 Proposal
* migrate CRA to Vite
* tailwind CSS
* supabase development tied to version control
* user can see previous entries
* encrypt entries so that they aren't stored as plaintext

## Contributing
### Features
For any feature that you'd like to see, create a branch from the `develop` branch named `feature/<feature-name>`. Once completed, make a pull request to the `develop` branch. The request will be rejected if it doesn't pass tests.

Note: a feature branch is only ready to be merged into `develop` if the unit (jest testing simple components), integration tests (RTL and jest mock) for that feature are also written. E2E tests should also be written in Cypress however if not, E2E tests should be made later off of the release branch.
### Release
Once the suite of features necessary for a release has been completed, make a
release branch named `release/x.y.z` from the `develop` branch.  If there aren't
adequate E2E tests for this release, create a branch off of release titled
`e2e/<test-names>`. Develop those E2E tests and make a pull request back to the
corresponding release branch. GH actions should run those E2E tests to ensure
they're passing.

A release branch is only ready to be merged into production when it is stable:
* passing tests
* release notes
* documentation updates

### Production / Main
When the release branch is merged into `main` there should be a github action which merges it into the `develop` branch. Or do it manually.

Tag the new commit on `main`, this can be done manually (or through gh actions). 

### Issues
For any issues that are present that need to be resolved please create a branch from the commit where the issue was found called `bugfix/<issue-id>`. 

## How to run local development server (both frontend and backend)
1. In another directory `git clone git@github.com:edward-20/zen-journal-supabase.git`. 
2. Follow the instructions on that repo's `README.md` to run containers locally that will provide supabase services.
3. In this repo, construct a `.env`, `.env.development` and provide each with:
* `REACT_APP_SUPABASE_URL` according to the result of `supabase start` in the supabase repo
* `REACT_APP_SUPABASE_KEY` according to the result of `supabase start` in the supabase repo
* `REACT_APP_BACKEND_API = https://journal-chat-backend-u7wru5pkua-ts.a.run.app/prompt`, a public api made to provide prompts based on url query parameters. For example: `https://journal-chat-backend-u7wru5pkua-ts.a.run.app/prompt?isStressed=yes&energy=high&overall=average`,
* `REACT_APP_NUM_TIMES_FETCH_FROM_BACKEND_OUT_OF_TEN = 6` to control the number of times in which a user will generate a prompt from the public backend api as opposed to reusing one from our database

## CORS Errors
You may get CORS errors when your React tries to AJAX to your local supabase service.
If you use chrome, [chrome doesn't allow cors requests to localhost](https://stackoverflow.com/questions/10883211/why-does-my-http-localhost-cors-origin-not-work)

There is an issue concerning [CORS requests to the Auth service of a local supabase](https://github.com/supabase/supabase/issues/28008).

## How to deploy (both frontend and backend)
The process of deploying will follow steps 1 and 2 from above but you'll need to `supabase link` - more about linking [supabase link](https://supabase.com/docs/reference/cli/supabase-link) - your 
supabase repo to a supabase project and `supabase db push` - more about pushing [supabase push](https://supabase.com/docs/reference/cli/supabase-db-push) - to that supabase project.

Importantly for the frontend you'll need to provide the environment variables
for `.env.prod` that use the deployed supabase values. You can find these on
your dashboard. Then follow the instructions for CRA deployment [here](https://create-react-app.dev/docs/deployment/).